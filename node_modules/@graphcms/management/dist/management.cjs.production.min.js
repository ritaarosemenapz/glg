"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("graphql-request"),t=require("nanoid");function n(e,t,n,r,i,a,o){try{var s=e[a](o),E=s.value}catch(e){return void n(e)}s.done?t(E):Promise.resolve(E).then(r,i)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,E,"next",e)}function E(e){n(o,i,a,s,E,"throw",e)}s(void 0)}))}}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var s,E,u,l,c=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function E(e,t,n,r){var i=Object.create((t&&t.prototype instanceof c?t:c).prototype),a=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=v(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var E=u(e,t,n);if("normal"===E.type){if(r=n.done?"completed":"suspendedYield",E.arg===l)continue;return{value:E.arg,done:n.done}}"throw"===E.type&&(r="completed",n.method="throw",n.arg=E.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=E;var l={};function c(){}function d(){}function p(){}var T={};T[i]=function(){return this};var h=Object.getPrototypeOf,R=h&&h(h(N([])));R&&R!==t&&n.call(R,i)&&(T=R);var f=p.prototype=c.prototype=Object.create(T);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){var r;this._invoke=function(i,a){function o(){return new t((function(r,o){!function r(i,a,o,s){var E=u(e[i],e,a);if("throw"!==E.type){var l=E.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(c).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(E.arg)}(i,a,r,o)}))}return r=r?r.then(o,o):o()}}function v(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,v(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function g(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function N(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=f.constructor=p,p.constructor=d,d.displayName=s(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e},e.awrap=function(e){return{__await:e}},m(I.prototype),I.prototype[a]=function(){return this},e.AsyncIterator=I,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new I(E(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(f),s(f,o,"Generator"),f[i]=function(){return this},f.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=N,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(g),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),E=n.call(a,"finallyLoc");if(s&&E){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!E)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),g(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;g(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:N(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(l={exports:{}}),l.exports);function d(e,t){return p.apply(this,arguments)}function p(){return(p=r(c.mark((function e(t,n){var r,i,a,s,E,u,l,d,p,T,h,R,f,m,I,v;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.replace("graphcms.com","hygraph.com"),e.prev=2,s="environment with endpoint '"+r+"' not found",e.next=6,t.request("\n    {\n      viewer {\n        ... on TokenViewer {\n          project {\n            id\n            environments {\n              id\n              name\n              endpoint\n            }\n          }\n        }\n        ...on UserViewer {\n          projects {\n            id\n            environments {\n              id\n              name\n              endpoint\n            }\n          }\n        }\n      }\n    }\n    ");case 6:if(u=null==(E=e.sent)||null==(i=E.viewer)?void 0:i.project,l=null==E||null==(a=E.viewer)?void 0:a.projects,u||l){e.next=11;break}return e.abrupt("return",Promise.reject(s));case 11:if(!l){e.next=27;break}d=o(l);case 13:if((p=d()).done){e.next=25;break}h=o((T=p.value).environments);case 16:if((R=h()).done){e.next=23;break}if((f=R.value).endpoint!==r){e.next=21;break}return f.projectId=T.id,e.abrupt("return",f);case 21:e.next=16;break;case 23:e.next=13;break;case 25:e.next=35;break;case 27:m=o(u.environments);case 28:if((I=m()).done){e.next=35;break}if((v=I.value).endpoint!==r){e.next=33;break}return v.projectId=u.id,e.abrupt("return",v);case 33:e.next=28;break;case 35:return e.abrupt("return",Promise.reject(s));case 38:throw e.prev=38,e.t0=e.catch(2),new Error(e.t0);case 41:case"end":return e.stop()}}),e,null,[[2,38]])})))).apply(this,arguments)}function T(e,t){return h.apply(this,arguments)}function h(){return(h=r(c.mark((function e(n,r){var i,a,o,s,E,u;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=["environmentId: $environmentId","changes: $changes","name: $name"],a="\n    mutation ("+["$environmentId: ID!","$changes: [BatchMigrationChangeInput!]!","$name: String!"].join(", ")+") {\n      submitBatchChanges(data: {\n        "+i.join(", ")+"\n      }) {\n        migration {\n          id,\n          status,\n          errors,\n        }\n      }\n    }\n  ",e.prev=3,s={changes:r.changes,environmentId:r.environmentId,name:r.name||t.nanoid()},e.next=7,n.request(a,s);case 7:if(u=null==(E=e.sent)||null==(o=E.submitBatchChanges)?void 0:o.migration){e.next=11;break}return e.abrupt("return",Promise.reject({errors:"unexpected response received"}));case 11:if(!u.errors){e.next=13;break}return e.abrupt("return",Promise.reject({id:u.id,errors:u.errors}));case 13:return e.abrupt("return",{id:u.id,status:u.status,name:s.name});case 16:return e.prev=16,e.t0=e.catch(3),e.abrupt("return",Promise.reject(e.t0));case 19:case"end":return e.stop()}}),e,null,[[3,16]])})))).apply(this,arguments)}function R(e,t){return f.apply(this,arguments)}function f(){return(f=r(c.mark((function e(t,n){var r,i,a,o,s,E,u;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={migrationId:n.migrationId,environmentName:n.environmentName,projectId:n.projectId},e.prev=2,s="migration with id '"+n.migrationId+"' not found",e.next=6,t.request("\n    query fetchMigration($projectId: ID!, $environmentName: String!, $migrationId: ID!){\n      viewer {\n        project(id: $projectId) {\n          environment(name: $environmentName) {\n            migration(id: $migrationId) {\n              id\n              status\n              errors\n              createdAt\n              finishedAt\n            }\n          }\n        }\n      }\n    }\n   ",r);case 6:if(u=null==(E=e.sent)||null==(i=E.viewer)||null==(a=i.project)||null==(o=a.environment)?void 0:o.migration){e.next=10;break}return e.abrupt("return",Promise.reject(s));case 10:return e.abrupt("return",u);case 13:return e.prev=13,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 16:case"end":return e.stop()}}),e,null,[[2,13]])})))).apply(this,arguments)}!function(e){e[e.Create=1]="Create",e[e.Update=2]="Update",e[e.Delete=3]="Delete"}(s||(s={})),(E=exports.RelationType||(exports.RelationType={}))[E.OneToOne=1]="OneToOne",E[E.OneToMany=2]="OneToMany",E[E.ManyToOne=3]="ManyToOne",E[E.ManyToMany=4]="ManyToMany",function(e){e[e.SimpleField=1]="SimpleField",e[e.RelationalField=2]="RelationalField",e[e.EnumerableField=3]="EnumerableField",e[e.UnionField=4]="UnionField",e[e.RemoteField=5]="RemoteField"}(u||(u={}));var m,I,v,A,g,C,N,O,_,S,L,D,P,U,y,M,w,b,F,G,x,k,B,j,V,W,H,Y,q,K,Q,$,J,X,z,Z,ee,te,ne,re,ie,ae,oe,se,Ee,ue,le,ce=function(){function e(e,t,n){void 0===n&&(n=u.SimpleField),this.args=e,this.mode=t,this.type=n}return e.prototype.generateChange=function(){var e,t=u[this.type];switch(this.mode){case s.Create:e="create"+t;break;case s.Update:e="update"+t;break;case s.Delete:e="deleteField"}var n={};return n[e]=this.args,n},e}();(m=exports.Renderer||(exports.Renderer={})).Default="GCMS",m.SingleLine="GCMS_SINGLE_LINE",m.MultiLine="GCMS_MULTI_LINE",m.Markdown="GCMS_MARKDOWN",m.Slug="GCMS_SLUG",function(e){e.Public="PUBLIC",e.Private="PRIVATE"}(I||(I={})),function(e){e.BuiltIn="BUILT_IN",e.Public="PUBLIC"}(v||(v={})),function(e){e.Asc="ASC",e.Desc="DESC"}(A||(A={})),function(e){e.Roles="ROLES",e.Locales="LOCALES",e.Environments="ENVIRONMENTS",e.Webhooks="WEBHOOKS",e.Models="MODELS",e.Records="RECORDS",e.AssetTraffic="ASSET_TRAFFIC",e.ApiOperations="API_OPERATIONS",e.Seats="SEATS",e.WorkflowSteps="WORKFLOW_STEPS",e.Integrations="INTEGRATIONS",e.Versions="VERSIONS",e.VersionRetentionPeriod="VERSION_RETENTION_PERIOD",e.ContentModels="CONTENT_MODELS",e.ContentStages="CONTENT_STAGES",e.AuditLogsRetentionPeriod="AUDIT_LOGS_RETENTION_PERIOD",e.RemoteSources="REMOTE_SOURCES",e.RemoteFields="REMOTE_FIELDS",e.RemoteFieldsMaxExecutionTime="REMOTE_FIELDS_MAX_EXECUTION_TIME",e.RemoteFieldsMaxResponseSize="REMOTE_FIELDS_MAX_RESPONSE_SIZE",e.RemoteFieldsHttpWorkers="REMOTE_FIELDS_HTTP_WORKERS",e.RateLimitPerSecond="RATE_LIMIT_PER_SECOND",e.ContentPermissions="CONTENT_PERMISSIONS",e.PermanentAuthTokens="PERMANENT_AUTH_TOKENS",e.SchedulingPendingReleases="SCHEDULING_PENDING_RELEASES",e.SchedulingPendingOperations="SCHEDULING_PENDING_OPERATIONS",e.SchedulingOperationsInRelease="SCHEDULING_OPERATIONS_IN_RELEASE"}(g||(g={})),function(e){e.ContentApi="CONTENT_API",e.ManagementApi="MANAGEMENT_API"}(C||(C={})),function(e){e.ProjectClone="PROJECT_CLONE",e.ProjectUpdate="PROJECT_UPDATE",e.ProjectDelete="PROJECT_DELETE",e.ManagePayment="MANAGE_PAYMENT",e.PlaygroundUse="PLAYGROUND_USE",e.AuditLogsRead="AUDIT_LOGS_READ",e.ViewTeamMemberSettings="VIEW_TEAM_MEMBER_SETTINGS",e.ViewRolePermissionSettings="VIEW_ROLE_PERMISSION_SETTINGS",e.ViewSchema="VIEW_SCHEMA",e.EnvironmentCreate="ENVIRONMENT_CREATE",e.EnvironmentRead="ENVIRONMENT_READ",e.EnvironmentUpdate="ENVIRONMENT_UPDATE",e.EnvironmentDelete="ENVIRONMENT_DELETE",e.EnvironmentPromote="ENVIRONMENT_PROMOTE",e.ModelCreate="MODEL_CREATE",e.ModelRead="MODEL_READ",e.ModelUpdate="MODEL_UPDATE",e.ModelDelete="MODEL_DELETE",e.ComponentCreate="COMPONENT_CREATE",e.ComponentRead="COMPONENT_READ",e.ComponentUpdate="COMPONENT_UPDATE",e.ComponentDelete="COMPONENT_DELETE",e.LocaleCreate="LOCALE_CREATE",e.LocaleRead="LOCALE_READ",e.LocaleUpdate="LOCALE_UPDATE",e.LocaleDelete="LOCALE_DELETE",e.StageCreate="STAGE_CREATE",e.StageRead="STAGE_READ",e.StageUpdate="STAGE_UPDATE",e.StageDelete="STAGE_DELETE",e.EnumerationCreate="ENUMERATION_CREATE",e.EnumerationRead="ENUMERATION_READ",e.EnumerationUpdate="ENUMERATION_UPDATE",e.EnumerationDelete="ENUMERATION_DELETE",e.FieldCreate="FIELD_CREATE",e.FieldRead="FIELD_READ",e.FieldUpdate="FIELD_UPDATE",e.FieldDelete="FIELD_DELETE",e.RemoteSourceCreate="REMOTE_SOURCE_CREATE",e.RemoteSourceRead="REMOTE_SOURCE_READ",e.RemoteSourceUpdate="REMOTE_SOURCE_UPDATE",e.RemoteSourceDelete="REMOTE_SOURCE_DELETE",e.PatCreate="PAT_CREATE",e.PatRead="PAT_READ",e.PatUpdate="PAT_UPDATE",e.PatDelete="PAT_DELETE",e.ContentviewCreate="CONTENTVIEW_CREATE",e.ContentviewRead="CONTENTVIEW_READ",e.ContentviewUpdate="CONTENTVIEW_UPDATE",e.ContentviewSystemUpdate="CONTENTVIEW_SYSTEM_UPDATE",e.ContentviewDelete="CONTENTVIEW_DELETE",e.StorageBucketCreate="STORAGE_BUCKET_CREATE",e.StorageBucketRead="STORAGE_BUCKET_READ",e.StorageBucketUpdate="STORAGE_BUCKET_UPDATE",e.StorageBucketDelete="STORAGE_BUCKET_DELETE",e.RoleCreate="ROLE_CREATE",e.RoleUpdate="ROLE_UPDATE",e.RoleDelete="ROLE_DELETE",e.WebhookCreate="WEBHOOK_CREATE",e.WebhookRead="WEBHOOK_READ",e.WebhookUpdate="WEBHOOK_UPDATE",e.WebhookDelete="WEBHOOK_DELETE",e.UserInvite="USER_INVITE",e.UserAssignrole="USER_ASSIGNROLE",e.UserRemove="USER_REMOVE",e.ViewGroupCreate="VIEW_GROUP_CREATE",e.ViewGroupRead="VIEW_GROUP_READ",e.ViewGroupUpdate="VIEW_GROUP_UPDATE",e.ViewGroupDelete="VIEW_GROUP_DELETE",e.ContentCreate="CONTENT_CREATE",e.ContentRead="CONTENT_READ",e.ContentUpdate="CONTENT_UPDATE",e.ContentDelete="CONTENT_DELETE",e.ContentPublish="CONTENT_PUBLISH",e.ContentUpdatePublished="CONTENT_UPDATE_PUBLISHED",e.ContentPermissionCreate="CONTENT_PERMISSION_CREATE",e.ContentPermissionRead="CONTENT_PERMISSION_READ",e.ContentPermissionUpdate="CONTENT_PERMISSION_UPDATE",e.ContentPermissionDelete="CONTENT_PERMISSION_DELETE",e.IntegrationCreate="INTEGRATION_CREATE",e.IntegrationRead="INTEGRATION_READ",e.IntegrationUpdate="INTEGRATION_UPDATE",e.IntegrationDelete="INTEGRATION_DELETE",e.NetlifyTriggerBuild="NETLIFY_TRIGGER_BUILD",e.VercelTriggerBuild="VERCEL_TRIGGER_BUILD",e.ExtensionCreate="EXTENSION_CREATE",e.ExtensionRead="EXTENSION_READ",e.ExtensionUpdate="EXTENSION_UPDATE",e.ExtensionDelete="EXTENSION_DELETE",e.AppCreate="APP_CREATE",e.AppUpdate="APP_UPDATE",e.AppDelete="APP_DELETE",e.AppInstallationCreate="APP_INSTALLATION_CREATE",e.AppInstallationUpdate="APP_INSTALLATION_UPDATE",e.AppInstallationDelete="APP_INSTALLATION_DELETE"}(N||(N={})),function(e){e.TimestampAsc="timestamp_ASC",e.TimestampDesc="timestamp_DESC"}(O||(O={})),function(e){e.Project="PROJECT",e.Environment="ENVIRONMENT",e.Model="MODEL",e.Stage="STAGE",e.Locale="LOCALE",e.Pat="PAT",e.Enumeration="ENUMERATION",e.Field="FIELD",e.Content="CONTENT",e.Webhook="WEBHOOK",e.Member="MEMBER",e.Role="ROLE",e.Viewgroup="VIEWGROUP",e.Contentview="CONTENTVIEW",e.Extension="EXTENSION",e.EnumerationValue="ENUMERATION_VALUE",e.Invite="INVITE",e.Component="COMPONENT"}(_||(_={})),function(e){e.Create="CREATE",e.Update="UPDATE",e.Delete="DELETE",e.Publish="PUBLISH",e.Unpublish="UNPUBLISH",e.Accept="ACCEPT"}(S||(S={})),function(e){e.User="USER",e.Pat="PAT",e.ThirdParty="THIRD_PARTY",e.Open="OPEN"}(L||(L={})),function(e){e.SchemaSetup="SCHEMA_SETUP",e.ContentAdded="CONTENT_ADDED",e.ExploreContentApi="EXPLORE_CONTENT_API",e.ApiPermissionsSet="API_PERMISSIONS_SET",e.ExternalTraffic="EXTERNAL_TRAFFIC"}(D||(D={})),function(e){e.Role="ROLE",e.Pat="PAT",e.Public="PUBLIC"}(P||(P={})),function(e){e.Queued="QUEUED",e.Running="RUNNING",e.Success="SUCCESS",e.Timeout="TIMEOUT",e.Failed="FAILED"}(U||(U={})),function(e){e.Scalar="SCALAR",e.Object="OBJECT",e.Interface="INTERFACE",e.Union="UNION",e.Enum="ENUM",e.InputObject="INPUT_OBJECT"}(y||(y={})),function(e){e.Netlify="NETLIFY",e.Vercel="VERCEL",e.GatsbyCloud="GATSBY_CLOUD"}(M||(M={})),function(e){e.Pink="PINK",e.Purple="PURPLE",e.Orange="ORANGE",e.Red="RED",e.Brown="BROWN",e.Teal="TEAL",e.Green="GREEN",e.Yellow="YELLOW"}(w||(w={})),function(e){e.CreatedContent="CREATED_CONTENT",e.UsedPlayground="USED_PLAYGROUND",e.CheckedQuickstart="CHECKED_QUICKSTART"}(b||(b={})),function(e){e.DeveloperEngineering="DEVELOPER_ENGINEERING",e.EditorialContent="EDITORIAL_CONTENT",e.Management="MANAGEMENT",e.Procurement="PROCUREMENT",e.ProductManagement="PRODUCT_MANAGEMENT",e.ProjectManagement="PROJECT_MANAGEMENT",e.Sales="SALES",e.SecurityLegal="SECURITY_LEGAL",e.Other="OTHER"}(F||(F={})),function(e){e.Custom="CUSTOM",e.System="SYSTEM",e.UserCreated="USER_CREATED"}(G||(G={})),function(e){e.Default="DEFAULT",e.Asset="ASSET"}(x||(x={})),function(e){e.Pat="PAT",e.Member="MEMBER",e.Public="PUBLIC"}(k||(k={})),function(e){e.CalledAtAsc="calledAt_ASC",e.CalledAtDesc="calledAt_DESC"}(B||(B={})),function(e){e.ContentModel="CONTENT_MODEL"}(j||(j={})),function(e){e.Create="CREATE",e.Update="UPDATE",e.Delete="DELETE",e.Publish="PUBLISH",e.Unpublish="UNPUBLISH"}(V||(V={})),function(e){e.Inline="INLINE",e.Sdk="SDK"}(W||(W={})),function(e){e.Input="INPUT",e.Form="FORM",e.Api="API"}(H||(H={})),function(e){e.Id="ID",e.String="STRING",e.Richtext="RICHTEXT",e.Int="INT",e.Float="FLOAT",e.Boolean="BOOLEAN",e.Json="JSON",e.Datetime="DATETIME",e.Date="DATE",e.Location="LOCATION",e.Color="COLOR",e.Graphql="GRAPHQL",e.Rest="REST",e.Enumeration="ENUMERATION",e.Relation="RELATION",e.Asset="ASSET",e.Union="UNION"}(Y||(Y={})),function(e){e.Private="PRIVATE",e.Pending="PENDING",e.Public="PUBLIC"}(q||(q={})),function(e){e.Field="field",e.FormSidebar="formSidebar",e.Page="page"}(K||(K={})),function(e){e.FieldRenderer="FieldRenderer",e.ListRenderer="ListRenderer",e.TableRenderer="TableRenderer"}(Q||(Q={})),function(e){e.Pending="PENDING",e.Completed="COMPLETED",e.Disabled="DISABLED"}($||($={})),function(e){e.Id="ID",e.String="STRING",e.Richtext="RICHTEXT",e.Int="INT",e.Float="FLOAT",e.Boolean="BOOLEAN",e.Json="JSON",e.Datetime="DATETIME",e.Date="DATE",e.Location="LOCATION",e.Color="COLOR"}(J||(J={})),function(e){e.Graphql="GRAPHQL",e.Rest="REST"}(X||(X={})),function(e){e.Get="GET",e.Post="POST"}(z||(z={})),function(e){e.Get="GET",e.Post="POST"}(Z||(Z={})),function(e){e.Enumeration="ENUMERATION"}(ee||(ee={})),function(e){e.Relation="RELATION",e.Asset="ASSET"}(te||(te={})),function(e){e.Component="COMPONENT"}(ne||(ne={})),function(e){e.Union="UNION"}(re||(re={})),function(e){e.ComponentUnion="COMPONENT_UNION"}(ie||(ie={})),function(e){e.ReadWrite="READ_WRITE",e.ReadOnly="READ_ONLY",e.Hidden="HIDDEN",e.ApiOnly="API_ONLY"}(ae||(ae={})),function(e){e.Information="INFORMATION",e.Stages="STAGES",e.Localizations="LOCALIZATIONS",e.Versions="VERSIONS",e.PreviewUrls="PREVIEW_URLS",e.Releases="RELEASES"}(oe||(oe={})),function(e){e.Graphql="GRAPHQL",e.Rest="REST"}(se||(se={})),function(e){e.CreateProjectFromTemplate="CREATE_PROJECT_FROM_TEMPLATE",e.CreateEnvironment="CREATE_ENVIRONMENT",e.Batch="BATCH",e.CreateStage="CREATE_STAGE",e.UpdateStage="UPDATE_STAGE",e.DeleteStage="DELETE_STAGE",e.CreateLocale="CREATE_LOCALE",e.UpdateLocale="UPDATE_LOCALE",e.DeleteLocale="DELETE_LOCALE",e.CreateModel="CREATE_MODEL",e.UpdateModel="UPDATE_MODEL",e.DeleteModel="DELETE_MODEL",e.CreateRemoteTypeDefinition="CREATE_REMOTE_TYPE_DEFINITION",e.UpdateRemoteTypeDefinition="UPDATE_REMOTE_TYPE_DEFINITION",e.DeleteRemoteTypeDefinition="DELETE_REMOTE_TYPE_DEFINITION",e.CreateEnumeration="CREATE_ENUMERATION",e.UpdateEnumeration="UPDATE_ENUMERATION",e.DeleteEnumeration="DELETE_ENUMERATION",e.CreateSimpleField="CREATE_SIMPLE_FIELD",e.CreateEnumerableField="CREATE_ENUMERABLE_FIELD",e.CreateRelationalField="CREATE_RELATIONAL_FIELD",e.CreateUnionField="CREATE_UNION_FIELD",e.CreateRemoteField="CREATE_REMOTE_FIELD",e.UpdateSimpleField="UPDATE_SIMPLE_FIELD",e.UpdateEnumerableField="UPDATE_ENUMERABLE_FIELD",e.UpdateRelationalField="UPDATE_RELATIONAL_FIELD",e.UpdateUnionField="UPDATE_UNION_FIELD",e.DeleteField="DELETE_FIELD"}(Ee||(Ee={})),function(e){e.Ready="READY",e.Preparing="PREPARING",e.Building="BUILDING",e.Failed="FAILED"}(ue||(ue={})),function(e){e.Ready="READY",e.Preparing="PREPARING",e.Building="BUILDING",e.Failed="FAILED"}(le||(le={}));var de=function(){function e(e,t,n){this.listener=e,this.mode=t,this.args=n}var t=e.prototype;return t.addSimpleField=function(e){var t=i({},e);t.modelApiId=this.args.apiId,t.type===J.String&&(t.formRenderer=t.formRenderer||exports.Renderer.SingleLine),t.validations&&(t.validations=pe(t));var n=new ce(t,s.Create);return this.listener.registerChange(n),this},t.updateSimpleField=function(e){var t=i({},e);t.modelApiId=this.args.apiId,t.validations&&(t.validations=pe(t));var n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(i[n]=e[n]);return i}(t,["type"]),r=new ce(n,s.Update);return this.listener.registerChange(r),this},t.addRelationalField=function(e){var t,n,r=i({},e);r.modelApiId=this.args.apiId;var a=null==(t=r.type)?void 0:t.toUpperCase(),o=null==(n=r.model)?void 0:n.toUpperCase();r.type=a===te.Asset||o===te.Asset?te.Asset:te.Relation,r.reverseField||(r.reverseField={apiId:"related"+r.modelApiId,displayName:"Related "+r.modelApiId}),r.reverseField.modelApiId=r.model,r.isList=r.relationType===exports.RelationType.OneToMany||r.relationType===exports.RelationType.ManyToMany,r.reverseField.isList=r.relationType===exports.RelationType.ManyToOne||r.relationType===exports.RelationType.ManyToMany,r.type===te.Asset?(void 0===r.isRequired&&(r.isRequired=!1),r.reverseField.isList=!0,r.reverseField.isHidden=!0):delete r.isRequired,delete r.model,delete r.relationType;var E=new ce(r,s.Create,u.RelationalField);return this.listener.registerChange(E),this},t.addUnionField=function(e){var t=i({},e);if(t.modelApiId=this.args.apiId,!t.models||0===t.models.length)throw new Error("models cannot be empty");t.reverseField||(t.reverseField={apiId:"related"+t.modelApiId,displayName:"Related "+t.modelApiId}),t.reverseField.modelApiIds=t.models,t.isList=t.relationType===exports.RelationType.OneToMany||t.relationType===exports.RelationType.ManyToMany,t.reverseField.isList=t.relationType===exports.RelationType.ManyToOne||t.relationType===exports.RelationType.ManyToMany,delete t.models,delete t.relationType;var n=new ce(t,s.Create,u.UnionField);return this.listener.registerChange(n),this},t.updateRelationalField=function(e){var t,n=i({},e);n.modelApiId=this.args.apiId,n.reverseField=null==e?void 0:e.reverseField,(null==(t=n.modelApiId)?void 0:t.toUpperCase())===te.Asset&&void 0!==n.isRequired&&(n.isRequired=Boolean(n.isRequired));var r=new ce(n,s.Update,u.RelationalField);return this.listener.registerChange(r),this},t.updateUnionField=function(e){var t=i({},e);t.modelApiId=this.args.apiId,t.reverseField=i({},null==e?void 0:e.reverseField,{modelApiIds:t.models}),delete t.models;var n=new ce(t,s.Update,u.UnionField);return this.listener.registerChange(n),this},t.addEnumerableField=function(e){var t=i({},e);if(!t.enumerationApiId)throw new Error("enumerationApiId is required for enumerable field");t.modelApiId=this.args.apiId;var n=new ce(t,s.Create,u.EnumerableField);return this.listener.registerChange(n),this},t.updateEnumerableField=function(e){var t=i({},e);t.modelApiId=this.args.apiId;var n=new ce(t,s.Update,u.EnumerableField);return this.listener.registerChange(n),this},t.addRemoteField=function(e){var t=i({},e);t.parentApiId=this.args.apiId;var n=new ce(t,s.Create,u.RemoteField);return this.listener.registerChange(n),this},t.updateRemoteField=function(e){var t=i({},e);t.parentApiId=this.args.apiId;var n=new ce(t,s.Update,u.RemoteField);return this.listener.registerChange(n),this},t.deleteField=function(e){var t=new ce({apiId:e,modelApiId:this.args.apiId},s.Delete);return this.listener.registerChange(t),this},t.hasChanges=function(){return this.mode!==s.Update||Object.keys(this.args).length>1},t.generateChange=function(){var e;switch(this.mode){case s.Create:e="createModel";break;case s.Update:e="updateModel";break;case s.Delete:e="deleteModel"}var t={};return t[e]=this.args,t},e}();function pe(e){var t,n,r,i,a,o={};switch(e.type){case J.Int:var s;o.Int={range:null==(t=e.validations)?void 0:t.range},e.isList&&(o.Int.listItemCount=null==(s=e.validations)?void 0:s.listItemCount);break;case J.Float:var E;o.Float={range:null==(n=e.validations)?void 0:n.range},e.isList&&(o.Float.listItemCount=null==(E=e.validations)?void 0:E.listItemCount);break;case J.String:var u;o.String={characters:null==(r=e.validations)?void 0:r.characters,matches:null==(i=e.validations)?void 0:i.matches,notMatches:null==(a=e.validations)?void 0:a.notMatches},e.isList&&(o.String.listItemCount=null==(u=e.validations)?void 0:u.listItemCount);break;default:throw new Error("field validations not supported for "+e.type)}return o}var Te=function(){function e(e,t){this.mode=e,this.args=t}var t=e.prototype;return t.addValue=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map((function(e){return{apiId:e,displayName:e}}));if(this.mode===s.Update){var i,a=this.args;a.valuesToCreate=a.valuesToCreate||[],(i=a.valuesToCreate).push.apply(i,r)}else{var o,E=this.args;E.values=E.values||[],(o=E.values).push.apply(o,r)}},t.updateValue=function(e,t){var n=this.args;return n.valuesToUpdate=n.valuesToUpdate||[],n.valuesToUpdate.push({apiId:e,newApiId:t,displayName:t||e}),this},t.deleteValue=function(){var e,t=this.args;t.valuesToDelete=t.valuesToDelete||[],(e=t.valuesToDelete).push.apply(e,arguments)},t.generateChange=function(){if(this.mode===s.Create){var e=this.args;if(!e.values||0===e.values.length)throw new Error("enumeration must have values")}var t;switch(this.mode){case s.Create:t="createEnumeration";break;case s.Update:t="updateEnumeration";break;case s.Delete:t="deleteEnumeration"}var n={};return n[t]=this.args,n},e}(),he=function(){function e(e,t){this.mode=e,this.args=t}var t=e.prototype;return t.hasChanges=function(){return this.mode!==s.Update||Object.keys(this.args).length>1},t.generateChange=function(){var e;switch(this.mode){case s.Create:e="createStage";break;case s.Update:e="updateStage";break;case s.Delete:e="deleteStage"}var t={};return t[e]=this.args,t},e}(),Re=function(){function e(e,t){this.mode=e,this.args=t}var t=e.prototype;return t.hasChanges=function(){return this.mode!==s.Update||Object.keys(this.args).length>1},t.generateChange=function(){var e;switch(this.mode){case s.Create:e="createLocale";break;case s.Update:e="updateLocale";break;case s.Delete:e="deleteLocale"}var t={};return t[e]=this.args,t},e}(),fe=function(){function e(e,t,n){this.mode=e,this.sourceType=t,this.args=n}var t=e.prototype;return t.hasChanges=function(){return this.mode!==s.Update||Object.keys(this.args).length>1},t.generateChange=function(){var e;switch(this.mode){case s.Create:e="GQL"===this.sourceType?"createGraphQLRemoteSource":"createRESTRemoteSource";break;case s.Update:e="GQL"===this.sourceType?"updateGraphQLRemoteSource":"updateRESTRemoteSource";break;case s.Delete:e="deleteRemoteSource"}var t={};return t[e]=this.args,t},e}(),me=process.env.GRAPHCMS_GRAPHQL_ENDPOINT||"https://management-next.graphcms.com/graphql",Ie=function(){function t(e){this.changeItems=[],this.migrated=!1,this.config=e}var n=t.prototype;return n.prepare=function(){var t=r(c.mark((function t(){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.client=new e.GraphQLClient(me,{headers:{authorization:"Bearer "+this.config.authToken,"apollographql-client-name":"management-sdk"}}),t.next=3,d(this.client,this.config.endpoint);case 3:this.environment=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.model=function(e){return new de(this,s.Update,{apiId:e})},n.createModel=function(e){var t=new de(this,s.Create,e);return this.registerChange(t),t},n.updateModel=function(e){var t=new de(this,s.Update,e);return this.registerChange(t),t},n.deleteModel=function(e){var t=new de(this,s.Delete,{apiId:e});return this.registerChange(t),t},n.createGraphQLRemoteSource=function(e){var t=new fe(s.Create,"GQL",e);return this.registerChange(t),t},n.updateGraphQLRemoteSource=function(e){var t=new fe(s.Update,"GQL",e);return this.registerChange(t),t},n.createRESTRemoteSource=function(e){var t=new fe(s.Create,"REST",e);return this.registerChange(t),t},n.updateRESTRemoteSource=function(e){var t=new fe(s.Update,"REST",e);return this.registerChange(t),t},n.deleteRemoteSource=function(e){var t=new fe(s.Delete,"REST",e);return this.registerChange(t),t},n.createEnumeration=function(e){var t=new Te(s.Create,e);return this.registerChange(t),t},n.updateEnumeration=function(e){var t=new Te(s.Update,e);return this.registerChange(t),t},n.deleteEnumeration=function(e){var t=new Te(s.Delete,{apiId:e});this.registerChange(t)},n.createStage=function(e){var t=new he(s.Create,e);return this.registerChange(t),t},n.updateStage=function(e){var t=new he(s.Update,e);return this.registerChange(t),t},n.deleteStage=function(e){var t=new he(s.Delete,{apiId:e});return this.registerChange(t),t},n.createLocale=function(e){var t=new Re(s.Create,e);return this.registerChange(t),t},n.updateLocale=function(e){var t=new Re(s.Update,e);return this.registerChange(t),t},n.deleteLocale=function(e){var t=new Re(s.Delete,{apiId:e});return this.registerChange(t),t},n.run=function(){var e=r(c.mark((function e(t){var n,r,a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.migrated){e.next=2;break}return e.abrupt("return",Promise.reject("migration previously done"));case 2:return e.next=4,this.prepare();case 4:return n=this.generateChanges(),e.next=7,T(this.client,{environmentId:this.environment.id,name:this.config.name,changes:n});case 7:if(r=e.sent,this.migrated=!0,!t){e.next=22;break}return e.prev=10,e.next=13,this.waitForMigration(r.id);case 13:if(!(a=e.sent).errors){e.next=16;break}return e.abrupt("return",a);case 16:return e.abrupt("return",i({name:r.name},a));case 19:return e.prev=19,e.t0=e.catch(10),e.abrupt("return",Promise.reject(e.t0));case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),n.dryRun=function(){return this.generateChanges()},n.waitForMigration=function(){var e=r(c.mark((function e(t){var n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,new Promise((function(e){return setTimeout(e,1e3)}));case 4:return e.next=6,R(this.client,{projectId:this.environment.projectId,environmentName:this.environment.name,migrationId:t});case 6:if((n=e.sent).status===U.Queued||n.status===U.Running){e.next=9;break}return e.abrupt("return",n);case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 14:e.next=0;break;case 16:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),n.generateChanges=function(){for(var e,t=[],n=o(this.changeItems);!(e=n()).done;)t.push(e.value.generateChange());return t},n.registerChange=function(e){this.changeItems.push(e)},t}(),ve=X,Ae=ae,ge=Z,Ce=z;exports.FieldType=J,exports.RemoteFieldApiMethod=Ce,exports.RemoteFieldType=ve,exports.RemoteSourceIntrospectionMethod=ge,exports.VisibilityTypes=Ae,exports.newMigration=function(e){return new Ie(e)};
//# sourceMappingURL=management.cjs.production.min.js.map
